<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    @@include('template/csslink.html',{"csslink":"css/style.css"})
    <title>結帳</title>
    <style>
        * {
            /* outline: 1px solid #f00; */
        }
    </style>
</head>

<body class="checkOrder">
    @@include('template/header.html')
    <section class="cart_list">
        <div class="container">
            <h2>訂單明細</h2>
            <div class="wrap">
                <div class="list_header">
                    <div>
                        <p>商品圖片</p>
                    </div>
                    <div>
                        <p>單價</p>
                    </div>
                    <div>
                        <p>數量</p>
                    </div>
                    <div>
                        <p>小計</p>
                    </div>
                </div>
                <!-- {"prodInfo":["Tshirt","馬克杯","img/shop/Tshirt.png","500"],"num":"1","img":"http://localhost/G3/img/collections/work_amlbg_5.png","name":"Tshirt|work_amlbg_5"} -->
                <!-- 動物圖片img  商品圖片prodInfo[2] 單價prodInfo[3] 數量num-->
                <div class="list_row">
                    <div class="prod_pic col-6">
                        <div class="pic_item">
                            <img src="img/shop/cup.png" alt="">
                        </div>
                    </div>
                    <div class="prod_info col-6">
                        <div class="price"><span class="title_inline">商品單價：</span>$600</div>
                        <div>
                            <span class="title_inline">商品數量：</span>
                            <span>1</span>
                        </div>
                        <div class="subTotal"><span class="title_inline">商品小計：</span>$600</div>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="list_row">
                    <div class="prod_pic col-6 ">
                        <div class="pic_item">
                            <img src="img/shop/cup.png" alt="">
                        </div>
                    </div>
                    <div class="prod_info col-6 ">
                        <!-- <div class="prod_name "><span class="title_inline">商品名稱：</span>馬克杯</div> -->
                        <div class="price"><span class="title_inline">商品單價：</span>$600</div>
                        <div>
                            <span class="title_inline">商品數量：</span>
                            <span>1</span>
                        </div>
                        <div class="subTotal"><span class="title_inline">商品小計：</span>$600</div>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <!-- 點數折抵 -->
                <div class="discount">
                    <h3>金幣折抵</h3>
                    <div class="discount_info">
                        <p>您目前持有金幣：$ <span>0</span></p>
                        <a href="game.html">玩遊戲賺金幣</a>
                    </div>
                    <div class="discount_input">
                        <p> $ <input type="number" id="enter_discount"></p>
                        <span>金幣$1可折抵現金1元</span>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="total">
                    <p></p>
                    <p>+運費：$60</p>
                    <p>-點數折抵：$<span>10</span></p>
                    <p>總金額為：$<span class="total_money">100</span></p>
                </div>
            </div>
    </section>
    <!-- 填寫資料 -->
    <div id="app">
<!-- vue開始 -->
    <section class="write_info">
        <div class="container">
            <h2>填寫資料</h2>
           
            <form class="wrap" >
                <div class="write_info_col">
                    <h3>收件人資訊</h3>
                    <p>姓名： <input id="name" type="text" v-model="name"
                            v-bind:class="{ 'is-invalid':nameError }"><span>{{nameErrMsg}}</span></p>
                    <p>電話： <input type="text" v-model="phone"
                            v-bind:class="{ 'is-invalid':phoneError }"><span>{{phoneErrMsg}}</span></p>
                    <p>地址： <input type="text" v-model="addr"></p>
                </div>
                <div class="write_info_col creditCard">
                    <h3>信用卡付款資訊</h3>
                    <p>信用卡帳號：
                        <input type="text" v-model="card1" v-bind:class="{ 'is-invalid':cardError }">-
                        <input type="text" v-model="card2" v-bind:class="{ 'is-invalid':cardError }">-
                        <input type="text" v-model="card3" v-bind:class="{ 'is-invalid':cardError }">-
                        <input type="text" v-model="card4" v-bind:class="{ 'is-invalid':cardError }">
                        <span>{{cardErrMsg}}</span>
                    </p>
                    <p>
                        有效期限：
                        <input type="text" v-model="month" v-bind:class="{ 'is-invalid':monthError }">
                        <input type="text" v-model="year" v-bind:class="{ 'is-invalid':yearError }">
                        <span>{{dateErrMsg}}</span>
                    </p>
                    <p>
                        背面安全碼
                        <input type="text" v-model="code" v-bind:class="{ 'is-invalid':codeError }">
                        <span>{{codeErrMsg}}</span>
                    </p>
                </div>
            </form>
        </div>
    </section>

    <div class="cart_btn">
        <a class="btn_cloudy" href="cart.php">上一步@@include('template/btn_sp.html')</a>
        <a class="btn_cloudp confirm" href="checkOder.html" @click="submit">送出訂單@@include('template/btn_sp.html')</a>
    
    </div>



    <!-- ====================再次確認資料的彈窗==================== -->
    <!-- vue開始 -->
    <div class="order_confirm">
        <div class="confirm_container">
            <p class="confirm_title">請確認您的資料：</p>
            <p class="confirm_title">收件人資訊：</p>
            <!-- <p>姓名：</p> -->
            <name :inname="name"></name>
            <phone :inphone="phone"></phone>
            <addr :inaddr="addr"></addr>
            <p class="confirm_title">信用卡資訊：</p>
            <p>信用卡帳號：{{card1}}-{{card2}}-{{card3}}-{{card4}}</p>
            <p>有效期限：{{month}}月{{year}}年</p>
            <div class="btn">
                <a class="btn_cloudy writeAgain">重新填寫@@include('template/btn_sp.html')</a>
                <a class="btn_cloudp submit" >確認送出@@include('template/btn_sp.html')</a>
            </div>
        </div>
    </div>
    <!-- vue結束 -->
</div>
    <!-- ==================送出訂單後，訂單資訊的彈窗============== -->
    <div class="order_info">
        <div class="order_info_container">
            <p class="order_info_title">訂單已成立</p>
            <p>請至會員中心查看訂單詳情。</p>
            <p>訂單編號：<span>001</span></p>
            <p>訂單成立時間：<span>2019/01/01 00:00</span></p>
            <p>訂單狀態：<span>已付款</span></p>
            <button class="btn_cloudb close"><span>關閉</span>@@include('template/btn_sp.html')</button>
        </div>
    </div>

    @@include('template/footer.html')
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.js"></script>
    <script>
        var form_vue = new Vue({
            data: {
                name: '',
                nameError: false,

                phone: '',
                phoneError: false,

                addr:'',
    
                card1: '',
                card2: '',
                card3: '',
                card4: '',
                cardError: false,

                code: '',
                codeError: false,

                month: '',
                monthError: false,

                year: '',
                yearError: false,

            },
            computed: {
                nameErrMsg() {
                    let isText = /[^0-9]/;
                    if (!isText.test(this.name) && this.name.length > 0) {
                        this.nameError = true;
                        return '請勿包含數字';
                    }

                    else {
                        this.nameError = false;
                    }
                },
                phoneErrMsg() {
                    let isText = /^\d{6,10}$/;
                    if (!isText.test(this.phone) && this.phone.length > 0) {
                        this.phoneError = true;
                        return '請輸入6-10位數字';
                    }
                    else {
                        this.phoneError = false;
                    }
                },
                cardErrMsg() {
                    let isText = /^\d{4}$/;
                    if (!isText.test(this.card1) && this.card1.length > 0) {
                        this.cardError = true;
                        return '請輸入4位數字';
                    } else if (!isText.test(this.card2) && this.card2.length > 0) {
                        this.cardError = true;
                        return '請輸入4位數字';
                    } else if (!isText.test(this.card3) && this.card3.length > 0) {
                        this.cardError = true;
                        return '請輸入4位數字';
                    } else if (!isText.test(this.card4) && this.card4.length > 0) {
                        this.cardError = true;
                        return '請輸入4位數字';
                    }
                    else {
                        this.cardError = false;

                    }
                },
                codeErrMsg() {
                    let isText = /^\d{3}$/;
                    if (!isText.test(this.code) && this.code.length > 0) {
                        this.codeError = true;
                        return '請輸入3位數字';
                    }
                    else {
                        this.codeError = false;
                    }
                },
                dateErrMsg() {
                    let monthText = /^[1-12]$/;
                    let yearText = /^[20]{2}[0-9]{2}$/;
                    if (!monthText.test(this.month) && this.month.length > 0) {
                        this.monthError = true;
                        return '請輸入：1-12';
                    } else if (!yearText.test(this.year) && this.year.length > 0) {
                        this.yearError = true;
                        return '請輸入:20XX';
                    }
                    else {
                        this.monthError = false;
                        this.yearError = false;
                    }
                },
            },
            components:{
                'name':{props:['inname'], template:'<p>姓名：{{inname}}</p>' },
                'phone':{props:['inphone'], template:'<p>行動電話：{{inphone}}</p>' },
                'addr':{props:['inaddr'], template:'<p>地址：{{inaddr}}</p>' },
                // 'name':{props:['inname'], template:'<p>姓名：{{inname}}</p>' },
            },
            methods:{
                submit(e){
                    e.preventDefault();
                    document.querySelector(".checkOrder .order_confirm").style.display = "block";
                    let a=0;
                    for(i in this.$data){
                        if (this.$data[i] === "" || this.$data[i] === true){
                           a++;
                           console.log(a,this.$data[i])
                        }
                    }
                    if(a != 0){
                        // console.log("不完整")
                        console.log(sessionStorage['shopList'])
                    }else{
                        console.log("done")
                        // document.querySelector(".checkOrder .order_confirm").style.display = "block";   //購物車頁的送出
               
                    }
                    
                   
                    
                }
            }
        });
        form_vue.$mount("#app");





        
            function  total(){    //總金額
           
            let cart_total=0;
            let subTotals=document.getElementsByClassName("subTotal");
            for (let i = 0; i < subTotals.length; i++) {
                cart_total += Number(subTotals[i].innerText.replace("$",""));
            }
            document.querySelector(".total").children[0].innerText=`商品金額：$${cart_total}`;

            let discount=Number(document.getElementById("enter_discount").value);
            document.getElementsByClassName("total_money")[0].innerText = cart_total+60-discount;
        }
        







        window.addEventListener("load", function () {
              //total
              total();

            //購物車頁的送出訂單
            let confirm = document.querySelector(".cart_btn .confirm");

            //確認資料視窗的確認送出
            let submitButton = document.querySelector(".order_confirm .submit");
            //確認資料視窗的重新填寫
            let writeAgain = document.querySelector(".order_confirm .writeAgain");
            //整個確認資料視窗
            let confirmWindow = document.querySelector(".checkOrder .order_confirm");

            //訂單成立視窗的關閉
            let closeButton = document.querySelector(".order_info .close");



            // confirm.onclick = function () {
                // confirmWindow.style.display = "block";   //購物車頁的送出
                // return false;
                // console.log(form_vue.$data);
                // consolle.log(document.getElementById("name").value)
               
            // };

            writeAgain.onclick = function () {   //重新填寫btn
                confirmWindow.style.display = "none";
            };

            submitButton.onclick = function () {     //確認資料視窗的確認送出
                confirmWindow.style.display = "none";
                document.querySelector(".order_info").style.display = "block";
                // let formArr=[form_vue.name,form_vue.phone,form_vue.addr,form_vue.card1,form_vue.card2,form_vue.card3,form_vue.card4,form_vue.code,]
                
            }

            closeButton.onclick = function () {   //訂單成立視窗的關閉
                document.querySelector(".order_info").style.display = "none";
            }


            //顯示金幣
            if (sessionStorage['game_money'].length > 1) {
                document.querySelector(".discount_info p span").innerText = sessionStorage['game_money']
            }

            //輸入折扣金幣
            //輸入金幣的input
            let discountInput = document.getElementById("enter_discount");
            discountInput.max = Number(sessionStorage['game_money']);

            discountInput.onchange = function () {
                if (Number(discountInput.value) > Number(sessionStorage['game_money'])) {
                    discountInput.value = '';
                    alert("您目前持有金幣不足");
                }
                total()
            }
        })

     
    </script>
</body>

</html>